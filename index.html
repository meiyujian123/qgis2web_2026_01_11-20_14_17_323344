<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="./resources/ol.css">
    <link rel="stylesheet" href="./resources/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="./resources/horsey.min.css">
    <link rel="stylesheet" type="text/css" href="./resources/ol-search-layer.min.css">
    <link href="./resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
    <link rel="stylesheet" href="./resources/qgis2web.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        #map {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* 强化透视标题样式 */
        .title-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.7);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            padding: 10px 20px;
            border: 1px solid rgba(204, 204, 204, 0.3);
            font-family: "Microsoft Yahei", 微软雅黑, Arial, sans-serif;
            font-size: 26px;
            font-weight: bold;
            z-index: 9999 !important;
            display: flex;
            align-items: center;
            gap: 15px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .title-logo {
            width: 80px;
            height: 80px;
            vertical-align: middle;
            object-fit: contain;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.12));
        }

        /* 搜索面板样式 */
        #photonBox {
            position: absolute;
            top: 150px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(204, 204, 204, 0.4);
            padding: 8px 10px;
            width: 260px;
            font-family: "Microsoft Yahei", 微软雅黑, Arial, sans-serif;
            font-size: 13px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        #photonInput {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 2px;
            outline: none;
        }

        #photonResults {
            max-height: 220px;
            overflow: auto;
            display: none;
            margin-top: 4px;
            border-top: 1px solid #eee;
        }

        .photon-item {
            padding: 6px 8px;
            border-bottom: 1px solid #f5f5f5;
        }

        /* 面板及图表 */
        #objective-panel, #chart-panel {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            z-index: 1000;
            font-family: "Microsoft Yahei", 微软雅黑, Arial, sans-serif;
        }

        #objective-panel {
            top: 400px;
            right: 10px;
            width: 220px;
        }

        #chart-panel {
            top: 580px;
            right: 10px;
            width: 380px;
        }

        #gdp-light-chart {
            width: 100%;
            height: 300px;
        }

        #credits {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.7);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            padding: 4px 12px;
            font-size: 12px;
            border: 1px solid rgba(204, 204, 204, 0.3);
            z-index: 1000;
        }
    </style>
    <title>内蒙古自治区GDP与夜间灯光强度可视化</title>
</head>
<body>
    <div class="title-container">
        <img src="./images/logo2.png" alt="校徽" class="title-logo">
        内蒙古自治区GDP与夜间灯光强度可视化
    </div>

    <div id="objective-panel" class="panel">
        <div class="panel-header" style="padding:8px; font-weight:bold; cursor:pointer; border-bottom:1px solid #eee;">研究目的</div>
        <div class="panel-content" style="padding:10px;">
            <ol style="margin:0; padding-left:20px;">
                <li>探究夜间灯光分布与各地级市GDP的联系。</li>
                <li>分析工业与贸易区对经济的影响。</li>
            </ol>
        </div>
    </div>

    <div id="chart-panel" class="panel">
        <div class="panel-header" style="padding:8px; font-weight:bold; cursor:pointer; border-bottom:1px solid #eee;">GDP与夜间灯光强度图表</div>
        <div class="panel-content">
            <div id="gdp-light-chart"></div>
        </div>
    </div>

    <div id="map">
        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>
    </div>

    <div id="photonBox">
        <strong>查询地级市GDP</strong>
        <input id="photonInput" type="text" placeholder="输入城市名，如：呼和浩特">
        <div id="photonResults"></div>
    </div>

    <div id="credits">
        数据来源：内蒙古统计局、天地图 | 底图 © OpenStreetMap | 导出工具：QGIS2Web
    </div>

    <script src="./resources/qgis2web_expressions.js"></script>
    <script src="./resources/proj4.js"></script>
    <script>proj4.defs('EPSG:4326', '+proj=longlat +datum=WGS84 +no_defs');</script>
    <script src="./resources/functions.js"></script>
    <script src="./resources/ol.js"></script>
    <script src="./resources/horsey.min.js"></script>
    <script src="./resources/ol-search-layer.js"></script>
    <script src="./resources/ol-layerswitcher.js"></script>
    <script src="./resources/photon-geocoder-autocomplete.min.js"></script>

    <script src="./layers/_1.js"></script>
    <script src="./layers/_railways_2.js"></script>
    <script src="./layers/_4.js"></script>
    <script src="./layers/_5.js"></script>

    <script src="./styles/_1_style.js"></script>
    <script src="./styles/_railways_2_style.js"></script>
    <script src="./styles/_4_style.js"></script>
    <script src="./styles/_5_style.js"></script>

    <script src="./layers/layers.js"></script>
    <script src="./resources/Autolinker.min.js"></script>
    <script src="./resources/qgis2web.js"></script>

    <script>
        // 1. 图表初始化
        function initChart() {
            const chartDom = document.getElementById('gdp-light-chart');
            const myChart = echarts.init(chartDom);
            const cityData = [
                ['呼和浩特市', 1743.9, 8.2], ['包头市', 2057.2, 7.9], ['乌海市', 0, 4.8],
                ['赤峰市', 1825.2, 6.1], ['通辽市', 1039.1, 5.8], ['鄂尔多斯市', 3533.7, 8.5],
                ['呼伦贝尔市', 1361.3, 5.2], ['巴彦淖尔市', 831.1, 4.5], ['乌兰察布市', 926.8, 4.2],
                ['兴安盟', 549.3, 3.8], ['锡林郭勒盟', 1009.5, 4.0], ['阿拉善盟', 284.4, 2.5]
            ];
            const option = {
                tooltip: { trigger: 'axis' },
                legend: { data: ['GDP', '灯光强度'], top: 25 },
                xAxis: { type: 'category', data: cityData.map(i => i[0]), axisLabel: { rotate: 45 } },
                yAxis: [{ type: 'value', name: '亿元' }, { type: 'value', name: '强度', position: 'right' }],
                series: [
                    { name: 'GDP', type: 'line', data: cityData.map(i => i[1]), color: '#0066cc' },
                    { name: '灯光强度', type: 'line', yAxisIndex: 1, data: cityData.map(i => i[2]), color: '#ff6600' }
                ]
            };
            myChart.setOption(option);
        }

        // 2. 搜索逻辑
        (function () {
            const cityGDPData = [
                { city: '呼和浩特市', gdp: 1743.9 }, { city: '包头市', gdp: 2057.2 },
                { city: '鄂尔多斯市', gdp: 3533.7 }, { city: '赤峰市', gdp: 1825.2 }
                // ... 可根据需要补充
            ];
            const input = document.getElementById('photonInput');
            const res = document.getElementById('photonResults');

            input.addEventListener('input', () => {
                const val = input.value.trim();
                if (!val) { res.style.display = 'none'; return; }
                const matches = cityGDPData.filter(i => i.city.includes(val));
                res.innerHTML = matches.map(i => `<div class="photon-item"><b>${i.city}</b><br>GDP: ${i.gdp} 亿元</div>`).join('');
                res.style.display = 'block';
            });
        })();

        window.onload = initChart;
    </script>
</body>
</html>